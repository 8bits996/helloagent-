# Task02 学习计划 - 构建你的Agent框架

**学习日期**: 2025-12-19  
**截止日期**: 2025-12-20  
**当前状态**: 📋 准备中  
**预计用时**: 6-8小时

---

## 📚 学习目标

### 核心目标
1. ✅ 理解Agent框架的设计理念和架构
2. ✅ 掌握HelloAgents框架的核心组件
3. ✅ 实现四种Agent范式的框架化版本
4. ✅ 掌握工具系统的设计和实现
5. ✅ 完成全部6道习题

### 能力提升
- 从"使用者"到"构建者"的转变
- 系统架构设计能力
- 模块化编程思维
- 软件工程最佳实践

---

## 📖 学习内容概览

### 第七章：构建你的Agent框架

#### **7.1 框架整体架构设计**
- 为何需要自建Agent框架
- HelloAgents框架的设计理念
  - ✨ 轻量级与教学友好
  - ✨ 基于标准API
  - ✨ 渐进式学习路径
  - ✨ **万物皆为工具** (核心理念)
- 本章学习目标

#### **7.2 HelloAgentsLLM - 统一的模型接口**
- 多模型供应商支持
- 本地模型支持 (Ollama/VLLM)
- 自动检测机制
- 流式响应处理

#### **7.3 核心基础组件**
- Message类 - 消息系统
- Config类 - 配置管理 (单例模式)
- Agent基类 - 抽象基类设计

#### **7.4 四种Agent范式的框架化实现**
1. **SimpleAgent** - 基础对话型
2. **ReActAgent** - 推理与行动
3. **ReflectionAgent** - 迭代优化
4. **PlanAndSolveAgent** - 计划执行

#### **7.5 工具系统构建**
- BaseTool抽象类
- ToolRegistry - 工具注册机制
- 内置工具：Calculator、Search
- ToolChain - 工具链
- AsyncToolExecutor - 异步执行器

---

## 📝 学习路线图

### 阶段一：理论学习 (2小时)

#### Step 1: 框架设计理念 (30分钟)
- [ ] 阅读 7.1 章节
- [ ] 理解四大主流框架的局限性
- [ ] 理解HelloAgents的设计理念
- [ ] 思考："万物皆为工具"的优势和局限

**关键概念**：
- 轻量级框架
- 教学友好性
- 万物皆工具
- 渐进式学习

#### Step 2: 核心组件设计 (1小时)
- [ ] 阅读 7.2 LLM接口设计
- [ ] 阅读 7.3 核心基础组件
- [ ] 理解Pydantic的作用
- [ ] 理解单例模式
- [ ] 理解模板方法模式

**关键概念**：
- Provider自动检测
- 数据验证 (Pydantic)
- 单例模式
- 模板方法模式
- 抽象基类

#### Step 3: 工具系统理解 (30分钟)
- [ ] 阅读 7.5 工具系统
- [ ] 理解工具注册机制
- [ ] 理解工具链设计
- [ ] 理解异步执行器

**关键概念**：
- 统一工具接口
- 注册表模式
- 工具链
- 并发执行

---

### 阶段二：环境准备 (30分钟)

#### Step 1: 安装框架
```bash
# 安装HelloAgents框架
pip install "hello-agents==0.1.1"

# 安装搜索工具扩展（可选）
pip install "hello-agents[search]==0.1.1"
```

#### Step 2: 准备环境变量
- [ ] 复制 `.env.example` 到 `.env`
- [ ] 配置 LLM API (使用Task01的配置)
- [ ] 测试环境是否正常

#### Step 3: 快速体验
- [ ] 运行30秒快速开始代码
- [ ] 验证SimpleAgent工作正常
- [ ] 验证工具调用功能

---

### 阶段三：代码实践 (3-4小时)

#### 实践1: SimpleAgent实现 (45分钟)
**目标**: 实现最基础的对话型Agent

- [ ] 创建 `simple_agent.py`
- [ ] 实现基础对话功能
- [ ] 实现历史记录管理
- [ ] 添加工具调用能力
- [ ] 测试运行

**核心代码**：
```python
class SimpleAgent(Agent):
    def _execute(self, user_input: str) -> str:
        # 添加用户消息到历史
        # 调用LLM生成响应
        # 返回结果
```

#### 实践2: ReActAgent框架化 (1小时)
**目标**: 对比Task01的实现，理解框架化改进

- [ ] 创建 `react_agent.py`
- [ ] 实现Thought-Action-Observation循环
- [ ] 集成工具调用
- [ ] 对比第四章的代码，列出改进点
- [ ] 测试运行

**对比重点**：
- 代码结构更清晰
- 工具调用更统一
- 错误处理更完善

#### 实践3: ReflectionAgent框架化 (1小时)
**目标**: 实现迭代优化Agent

- [ ] 创建 `reflection_agent.py`
- [ ] 实现Execute-Reflect-Refine循环
- [ ] 添加质量评分机制（习题要求）
- [ ] 测试素数优化任务
- [ ] 对比改进

**扩展功能**：
```python
def _evaluate_quality(self, output: str) -> float:
    """LLM评分机制"""
    # 让LLM对输出质量打分 0-100
    # 返回分数
```

#### 实践4: PlanAndSolveAgent框架化 (45分钟)
**目标**: 实现计划执行Agent

- [ ] 创建 `plan_solve_agent.py`
- [ ] 实现Planning阶段
- [ ] 实现Solving阶段
- [ ] 测试数学题
- [ ] 对比改进

#### 实践5: 自定义工具实现 (30分钟)
**目标**: 掌握工具开发

- [ ] 实现CalculatorTool
- [ ] 实现工具注册
- [ ] 测试工具调用
- [ ] 设计3个工具串联的场景（习题）

**示例工具链场景**：
```
用户查询天气 → 搜索工具 → 数据解析工具 → 格式化工具 → 返回结果
```

---

### 阶段四：习题完成 (2-3小时)

#### 习题1: 框架设计分析 (30分钟)
- [ ] 分析主流框架局限性
- [ ] 评估"万物皆工具"设计
- [ ] 对比框架化改进
- [ ] 提出自己的设计原则

#### 习题2: 多模型支持扩展 (实践题, 1小时)
- [ ] 添加新Provider支持（Gemini/Anthropic/Kim）
- [ ] 分析优先级检测机制
- [ ] 对比VLLM/SGLang/Ollama

**实现示例**：
```python
class GeminiProvider(LLMProvider):
    def detect(self) -> bool:
        return os.getenv("GEMINI_API_KEY") is not None
    
    def get_client_config(self) -> dict:
        return {
            "api_key": os.getenv("GEMINI_API_KEY"),
            "base_url": "https://generativelanguage.googleapis.com/v1beta"
        }
```

#### 习题3: 核心组件分析 (30分钟)
- [ ] 分析Pydantic的优势
- [ ] 解释模板方法模式
- [ ] 解释单例模式的必要性

#### 习题4: Agent范式扩展 (实践题, 1小时)
- [ ] 对比ReAct改进点
- [ ] 实现质量评分机制
- [ ] **挑战**: 实现Tree-of-Thought Agent

**ToT Agent设计**：
```python
class TreeOfThoughtAgent(Agent):
    def _execute(self, user_input: str) -> str:
        # 1. 生成多个思考路径 (BFS/DFS)
        # 2. 评估每条路径的质量
        # 3. 选择最优路径
        # 4. 继续扩展
```

#### 习题5: 工具系统设计 (45分钟)
- [ ] 解释统一接口的重要性
- [ ] 设计3工具串联场景
- [ ] 分析并行执行的适用场景

**3工具链场景示例**：
```
旅行规划系统：
1. 天气查询工具 → 获取目的地天气
2. 景点搜索工具 → 推荐合适景点
3. 路线规划工具 → 生成游览路线
```

#### 习题6: 框架扩展设计 (1小时)
- [ ] 设计流式输出功能
- [ ] 设计多轮对话管理
- [ ] **挑战**: 设计插件系统架构

**插件系统架构**：
```
PluginManager
    ├─ 插件注册
    ├─ 插件加载
    ├─ 插件生命周期管理
    └─ 插件通信接口
```

---

## 🎯 重点难点

### 设计模式理解
1. **单例模式** (Config)
   - 为什么配置需要单例？
   - 如何实现线程安全的单例？

2. **模板方法模式** (Agent基类)
   - `run()` vs `_execute()`
   - 公开接口与内部实现分离

3. **注册表模式** (ToolRegistry)
   - 动态注册工具
   - 工具查找和执行

### 框架化思维
- **抽象层设计**: 找到合适的抽象程度
- **职责分离**: 每个类单一职责
- **接口统一**: 统一的工具接口
- **可扩展性**: 易于添加新功能

### 对比学习重点
对比Task01从零实现 vs Task02框架化：

| 维度 | Task01 | Task02 |
|------|--------|--------|
| 代码组织 | 单文件 | 模块化 |
| 工具调用 | 硬编码 | 注册表 |
| 错误处理 | 基础 | 完善 |
| 可复用性 | 低 | 高 |
| 可测试性 | 中 | 高 |

---

## ✅ 检查清单

### 理论理解
- [ ] 理解四大框架局限性
- [ ] 理解"万物皆工具"理念
- [ ] 掌握Provider自动检测机制
- [ ] 理解三大设计模式
- [ ] 理解工具系统架构

### 代码实践
- [ ] SimpleAgent实现并测试
- [ ] ReActAgent框架化完成
- [ ] ReflectionAgent + 质量评分
- [ ] PlanAndSolveAgent框架化
- [ ] 自定义工具开发
- [ ] 新Provider扩展（习题2）
- [ ] Tree-of-Thought Agent（习题4，挑战）

### 习题完成
- [ ] 习题1: 框架设计分析
- [ ] 习题2: 多模型支持扩展 ⭐实践
- [ ] 习题3: 核心组件分析
- [ ] 习题4: Agent范式扩展 ⭐实践
- [ ] 习题5: 工具系统设计
- [ ] 习题6: 框架扩展设计 ⭐挑战

### 文档输出
- [ ] 完整学习笔记
- [ ] 代码注释完善
- [ ] 习题解答文档
- [ ] 对比分析报告
- [ ] Task02总结

---

## 📊 时间分配建议

| 阶段 | 内容 | 预计时间 |
|------|------|----------|
| 阶段一 | 理论学习 | 2小时 |
| 阶段二 | 环境准备 | 0.5小时 |
| 阶段三 | 代码实践 | 3-4小时 |
| 阶段四 | 习题完成 | 2-3小时 |
| **总计** | | **7.5-9.5小时** |

**建议安排**：
- **Day 1 (2025-12-19)**: 阶段一、二、三 (6小时)
- **Day 2 (2025-12-20)**: 阶段四 + 总结 (3小时)

---

## 🎓 学习策略

### 1. 先体验，后实现
```
安装框架 → 运行示例 → 理解原理 → 自己实现
```

### 2. 对比学习
```
Task01代码 ←→ Task02框架化代码
- 找出改进点
- 理解为什么这样改
- 总结设计原则
```

### 3. 实践驱动
- 每个概念都要跑代码验证
- 每个习题都要实际实现
- 不懂就debug，看内部实现

### 4. 文档先行
- 阅读文档理解设计
- 看源码理解实现
- 写注释巩固理解

---

## 📚 参考资源

### 课程资料
- **第七章文档**: `hello-agents/docs/chapter7/`
- **示例代码**: `hello-agents/code/chapter7/`
- **源码仓库**: https://github.com/jjyaoao/helloagents

### 扩展阅读
- **设计模式**: 单例、模板方法、注册表
- **软件架构**: 模块化、接口设计、依赖注入
- **Python最佳实践**: Pydantic、ABC、类型注解

---

## 🎯 预期成果

### 代码产出
```
cfp-study/
└── Task02/
    ├── simple_agent.py           # SimpleAgent实现
    ├── react_agent.py            # ReAct框架化
    ├── reflection_agent.py       # Reflection + 评分
    ├── plan_solve_agent.py       # PlanAndSolve框架化
    ├── tot_agent.py              # Tree-of-Thought (挑战)
    ├── custom_tools.py           # 自定义工具
    ├── gemini_provider.py        # 新Provider扩展
    └── tests/                    # 测试文件
```

### 文档产出
```
├── Task02-学习笔记.md          # 完整笔记
├── Task02-习题解答.md          # 习题答案
├── Task02-对比分析.md          # Task01 vs Task02
├── Task02-框架设计.md          # 架构设计思考
└── Task02-总结.md              # 学习总结
```

### 能力提升
- ✅ Agent框架设计能力
- ✅ 设计模式应用能力
- ✅ 代码架构能力
- ✅ 系统思维能力
- ✅ 从使用者到构建者的转变

---

## 💡 学习建议

### 对于有框架经验的学习者
- 重点关注HelloAgents的设计理念
- 对比你熟悉的框架，思考优劣
- 尝试实现习题6的插件系统（挑战）

### 对于初学者
- 先跑通示例代码
- 逐个模块理解
- 先不急着做挑战题
- 重点理解设计模式

### 对于想深入的学习者
- 阅读HelloAgents源码
- 实现所有挑战题
- 尝试为框架贡献PR
- 设计自己的Agent框架

---

## 🚀 下一步

完成Task02后，你将具备：
1. ✅ 框架设计能力
2. ✅ 四种Agent范式的框架化实现
3. ✅ 工具系统设计经验
4. ✅ 设计模式实践经验

**Task03预告** (2025-12-22截止):
- 第八章：记忆与检索
- Memory机制
- RAG系统
- 向量数据库

---

**创建时间**: 2025-12-18  
**最后更新**: 2025-12-18  
**版本**: 1.0.0

---

**加油！从使用者到构建者的转变，就从Task02开始！** 🚀
