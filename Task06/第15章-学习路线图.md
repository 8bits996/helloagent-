# 第15章 - 赛博小镇学习路线图

**学习者**: Franke Chen  
**创建日期**: 2025-12-27  
**预计完成**: 2025-12-30（3-4天）

---

## 🎯 学习目标

通过第15章的学习，你将：
- ✅ 掌握 AI 与游戏引擎结合的完整方案
- ✅ 理解前后端分离的系统架构
- ✅ 学会 Godot 游戏开发基础
- ✅ 实现智能 NPC 系统
- ✅ 完成 Task06 的全部学习

---

## 📅 3天学习计划

### 第1天：环境准备 + 快速体验（2025-12-27）⏰

#### 上午（2小时）
- [ ] **安装 Godot** (30分钟)
  - 下载 Godot 4.2+
  - 熟悉基本界面
  - 阅读简单教程

- [ ] **配置后端环境** (30分钟)
  - 进入 backend 目录
  - 创建虚拟环境
  - 安装依赖包
  - 配置 .env 文件

- [ ] **启动项目** (30分钟)
  - 启动后端服务
  - 打开 Godot 项目
  - 运行游戏
  - 测试基本功能

- [ ] **初步体验** (30分钟)
  - 与 3 个 NPC 对话
  - 观察巡逻行为
  - 测试好感度变化
  - 查看后端日志

#### 下午（2-3小时）
- [ ] **阅读文档** (1小时)
  - 阅读 `第15章-代码结构分析.md`
  - 理解项目整体架构
  - 了解文件结构

- [ ] **理论学习** (1-2小时)
  - 阅读官方第15章文档
  - 理解四层架构设计
  - 理解批量生成原理
  - 理解好感度系统设计

#### 晚上（1-2小时）
- [ ] **代码浏览** (1-2小时)
  - 浏览 `agents.py` (NPC Agent 系统)
  - 浏览 `relationship_manager.py` (好感度)
  - 浏览 `api_client.gd` (前端 API)
  - 浏览 `player.gd` (玩家控制)

**今日目标**: ✅ 成功运行项目 + 理解整体架构

---

### 第2天：深入学习后端（2025-12-28）⏰

#### 上午（3小时）
- [ ] **agents.py 深入学习** (1.5小时)
  ```python
  重点关注：
  1. NPC_ROLES 配置 - 3个NPC的角色设定
  2. create_system_prompt() - 提示词构建
  3. NPCAgentManager.chat() - 对话处理流程
  4. 记忆系统集成 - WorkingMemory + EpisodicMemory
  5. 好感度集成 - 如何影响系统提示词
  ```

- [ ] **relationship_manager.py 深入学习** (1小时)
  ```python
  重点关注：
  1. AFFINITY_LEVELS - 五级好感度定义
  2. update_affinity() - 好感度更新逻辑
  3. get_affinity_level() - 等级判断
  4. 情感分析 - LLM 自动分析态度
  5. SQLite 存储 - 持久化机制
  ```

- [ ] **实践：添加新 NPC** (30分钟)
  - 在 NPC_ROLES 中添加"赵六"（运维工程师）
  - 设计性格和对话风格
  - 重启服务测试

#### 下午（3小时）
- [ ] **main.py 学习** (1小时)
  ```python
  重点关注：
  1. FastAPI 应用创建和配置
  2. 生命周期管理 (lifespan)
  3. API 路由定义
  4. CORS 配置
  ```

- [ ] **state_manager.py 学习** (1小时)
  ```python
  重点关注：
  1. 定时更新循环
  2. 批量生成调用
  3. 缓存机制
  4. 异步处理
  ```

- [ ] **batch_generator.py 学习** (1小时)
  ```python
  重点关注：
  1. 批量提示词构建
  2. JSON 解析
  3. 成本优化原理（66%降低）
  4. 预设对话机制
  ```

#### 晚上（1-2小时）
- [ ] **后端测试** (1小时)
  - 使用 Swagger UI 测试 API
  - 测试 /chat 接口
  - 测试 /npcs/status 接口
  - 查看日志输出

- [ ] **总结笔记** (1小时)
  - 整理后端学习笔记
  - 画架构图
  - 标注重点代码

**今日目标**: ✅ 理解后端所有核心代码 + 实现1个扩展

---

### 第3天：深入学习前端（2025-12-29）⏰

#### 上午（3小时）
- [ ] **Godot 基础学习** (1小时)
  ```
  核心概念：
  1. Node (节点) 和 Scene (场景)
  2. GDScript 语法基础
  3. Signal (信号) 机制
  4. Inspector 面板使用
  ```

- [ ] **player.gd 深入学习** (1小时)
  ```gdscript
  重点关注：
  1. _physics_process() - 物理帧处理
  2. 输入检测 - Input.get_vector()
  3. 移动控制 - move_and_slide()
  4. 动画切换 - update_animation()
  5. 交互检测 - interact_with_npc()
  ```

- [ ] **npc.gd 深入学习** (1小时)
  ```gdscript
  重点关注：
  1. 随机巡逻算法
  2. Area2D 交互检测
  3. 对话气泡显示
  4. 状态更新机制
  ```

#### 下午（3小时）
- [ ] **api_client.gd 深入学习** (1.5小时)
  ```gdscript
  重点关注：
  1. HTTPRequest 使用
  2. 信号定义和发送
  3. JSON 序列化/反序列化
  4. 异步请求处理
  5. 错误处理机制
  ```

- [ ] **dialogue_ui.gd 深入学习** (1.5小时)
  ```gdscript
  重点关注：
  1. UI 显示/隐藏
  2. 输入处理
  3. 富文本显示 (RichTextLabel)
  4. 对话历史管理
  5. 信号连接
  ```

#### 晚上（2小时）
- [ ] **场景编辑实践** (1小时)
  - 在 Godot 中打开各个场景
  - 理解节点结构
  - 修改 UI 样式
  - 调整参数测试

- [ ] **前端扩展实践** (1小时)
  - 修改玩家移动速度
  - 调整 NPC 巡逻范围
  - 改变对话框样式
  - 添加背景音乐

**今日目标**: ✅ 理解前端所有核心代码 + 实现2个扩展

---

### 第4天：综合实践 + 总结（2025-12-30）⏰

#### 上午（3小时）
- [ ] **综合实践项目1：添加第4个NPC** (1.5小时)
  - **后端**: 在 agents.py 添加 NPC 配置
  - **前端**: 在 main.tscn 添加 NPC 实例
  - **测试**: 与新 NPC 对话
  - **验证**: 好感度和记忆系统

- [ ] **综合实践项目2：优化好感度系统** (1.5小时)
  - 在对话 UI 中显示好感度
  - 添加好感度变化动画
  - 调整好感度计算公式
  - 测试不同等级的对话差异

#### 下午（3小时）
- [ ] **系统测试** (1.5小时)
  - **功能测试**: 所有功能正常工作
  - **压力测试**: 连续对话测试
  - **记忆测试**: 长期记忆检索
  - **好感度测试**: 等级变化测试

- [ ] **性能优化** (1.5小时)
  - 调整 NPC 更新间隔
  - 优化 API 调用次数
  - 减少不必要的日志
  - 测试优化效果

#### 晚上（2-3小时）
- [ ] **学习总结** (2小时)
  - 整理第15章学习笔记
  - 总结核心技术点
  - 记录遇到的问题和解决方案
  - 反思学习收获

- [ ] **Task06 总结** (1小时)
  - 完成 Task06 总结文档
  - 回顾第13/14/15章
  - 整理代码和文档
  - 准备进入 Task07

**今日目标**: ✅ 完成综合实践 + 完成学习总结 + Task06结业

---

## 📚 配套学习资料

### 已创建的文档
1. ✅ [第15章-快速开始.md](./第15章-快速开始.md) - 30分钟快速启动
2. ✅ [第15章-代码结构分析.md](./第15章-代码结构分析.md) - 完整代码解析
3. ✅ [第15章-构建赛博小镇-学习指南.md](./学习笔记/第15章-构建赛博小镇-学习指南.md) - 详细学习指南

### 官方资源
- 📘 [Hello Agents - 第15章](https://github.com/datawhalechina/hello-agents/blob/main/docs/chapter15/第十五章%20构建赛博小镇.md)
- 🎮 [Godot 官方文档](https://docs.godotengine.org/)
- 🐍 [FastAPI 文档](https://fastapi.tiangolo.com/)

### 项目文档
- 📄 [SETUP_GUIDE.md](./official-code/code/chapter15/Helloagents-AI-Town/SETUP_GUIDE.md)
- 📄 [DIALOGUE_LOG_GUIDE.md](./official-code/code/chapter15/Helloagents-AI-Town/DIALOGUE_LOG_GUIDE.md)
- 📄 [AFFINITY_SYSTEM_GUIDE.md](./official-code/code/chapter15/Helloagents-AI-Town/AFFINITY_SYSTEM_GUIDE.md)
- 📄 [MEMORY_SYSTEM_GUIDE.md](./official-code/code/chapter15/Helloagents-AI-Town/MEMORY_SYSTEM_GUIDE.md)

---

## ✅ 学习检查清单

### 理论知识
- [ ] 理解四层架构设计（前端、后端、智能体、外部服务）
- [ ] 理解前后端分离思想
- [ ] 理解批量生成原理（成本降低66%）
- [ ] 理解好感度系统设计（五级体系）
- [ ] 理解记忆系统设计（短期+长期）

### 后端技能
- [ ] 能够阅读和理解 agents.py
- [ ] 能够阅读和理解 relationship_manager.py
- [ ] 能够修改 NPC 的角色设定
- [ ] 能够添加新的 NPC
- [ ] 能够调整好感度计算逻辑

### 前端技能
- [ ] 能够使用 Godot 编辑器
- [ ] 能够阅读 GDScript 代码
- [ ] 能够修改场景和节点
- [ ] 能够调整游戏参数
- [ ] 能够扩展游戏功能

### 实践能力
- [ ] 能够独立启动和运行项目
- [ ] 能够调试前后端问题
- [ ] 能够查看和分析日志
- [ ] 能够测试系统功能
- [ ] 能够实现简单的扩展

---

## 🎓 核心收获总结

### 技术能力
1. **全栈开发能力**
   - 后端：FastAPI + Python
   - 前端：Godot + GDScript
   - 数据库：SQLite + Qdrant

2. **系统架构能力**
   - 前后端分离
   - RESTful API 设计
   - 异步处理
   - 批量优化

3. **AI 应用能力**
   - NPC Agent 系统
   - 记忆管理
   - 好感度系统
   - 提示词工程

### 项目经验
1. **赛博小镇游戏**
   - 智能 NPC 对话
   - 记忆和好感度系统
   - 游戏化交互
   - 完整的前后端

2. **可扩展性**
   - 添加新 NPC
   - 扩展功能
   - 优化性能
   - 自定义样式

### 职业价值
1. **AI 游戏开发**
   - 将 AI 技术应用到游戏中
   - 创造更智能的 NPC
   - 提升游戏体验

2. **虚拟场景应用**
   - 教育游戏
   - 虚拟办公
   - 心理健康
   - 社交模拟

---

## 🚀 完成后的下一步

### Task07: 毕业设计（最终挑战）
完成第15章后，你将进入 Task07 毕业设计，可以选择：

1. **基于赛博小镇的扩展**
   - 添加任务系统
   - NPC 互动
   - 动态事件
   - 更多场景

2. **全新的 Agent 项目**
   - 智能客服系统
   - 文档助手
   - 代码助手
   - 教育应用

3. **研究型项目**
   - Agent 性能优化
   - 记忆系统改进
   - 多 Agent 协作
   - 成本优化策略

---

## 💡 学习建议

### 学习方法
1. **先体验后学习**: 先运行项目，再深入代码
2. **理论结合实践**: 边学边做，多动手
3. **循序渐进**: 从简单到复杂，不要急
4. **记录总结**: 写笔记，画图，整理思路
5. **遇到问题不放弃**: 多调试，多查资料

### 时间管理
- **集中学习**: 每天至少2-3小时
- **劳逸结合**: 适当休息，保持效率
- **坚持到底**: 3-4天完成全部内容
- **及时总结**: 每天结束前写总结

### 学习心态
- **保持好奇心**: 探索代码的奥秘
- **勇于尝试**: 不怕出错，多实验
- **享受过程**: 学习本身就是乐趣
- **相信自己**: 你已经走了这么远，一定能完成！

---

## 📞 需要帮助？

如果在学习过程中遇到问题：
1. 查看相关文档和指南
2. 查看后端日志和 Godot 控制台
3. 搜索错误信息
4. 询问 AI 助手（我随时在这里！）

---

**加油！你已经完成了 Task00-05 和 Task06 的前两章，只差最后一章就能完成整个 Task06！** 💪

**Let's finish this strong!** 🚀

---

**创建时间**: 2025-12-27  
**计划开始**: 2025-12-27  
**计划完成**: 2025-12-30  
**状态**: 📋 准备就绪
