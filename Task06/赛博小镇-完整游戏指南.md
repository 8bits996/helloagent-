# 🎮 赛博小镇 - 完整游戏指南

## 目录
1. [快速开始](#快速开始)
2. [游戏介绍](#游戏介绍)
3. [游戏操作](#游戏操作)
4. [NPC角色介绍](#npc角色介绍)
5. [好感度系统详解](#好感度系统详解)
6. [AI对话系统](#ai对话系统)
7. [游戏目标与玩法](#游戏目标与玩法)
8. [高级技巧](#高级技巧)
9. [系统监控与调试](#系统监控与调试)
10. [常见问题解答](#常见问题解答)

---

## 快速开始

### 🚀 启动游戏

#### 方法一：一键启动（推荐）
1. 双击桌面上的 `auto-start-cybertown.ps1`
2. 或右键 → "使用 PowerShell 运行"
3. 等待后端服务启动（约10秒）
4. Godot 编辑器自动打开
5. 在 Godot 中按 **F5** 启动游戏

#### 方法二：手动启动
1. **启动后端**：
   ```powershell
   cd C:\Users\frankechen\CFP-Study\Task06\official-code\code\chapter15\Helloagents-AI-Town\backend
   .\venv\Scripts\python.exe main.py
   ```

2. **启动 Godot**：
   ```powershell
   C:\Godot\Godot_v4.3-stable_win64.exe --path "C:\Users\frankechen\CFP-Study\Task06\official-code\code\chapter15\Helloagents-AI-Town\helloagents-ai-town"
   ```

3. **运行游戏**：在 Godot 中按 **F5**

---

## 游戏介绍

### 🌆 游戏背景
《赛博小镇》是一款结合了 AI 技术的模拟社交游戏。你将扮演一个小镇居民，与三位由 AI 驱动的 NPC 进行互动。每个 NPC 都有独特的性格、记忆系统和情感反应。

### 🎯 核心特色
- **AI 驱动对话**：每个 NPC 由大语言模型驱动，能够进行真实的对话
- **记忆系统**：NPC 会记住你的对话内容和互动历史
- **好感度系统**：你的言行会影响 NPC 对你的好感，分为5个等级
- **动态行为**：NPC 会自主行动、闲聊，即使你不与他们互动
- **批量优化**：后端使用批量生成技术，提升响应速度并降低 API 成本

### 🎨 技术架构
- **前端**：Godot 4.3 游戏引擎 + GDScript
- **后端**：FastAPI + Python + HelloAgents 框架
- **AI 模型**：Qwen2.5-7B-Instruct（通过 SiliconFlow API）
- **存储**：SQLite 数据库（记忆系统）

---

## 游戏操作

### ⌨️ 键盘控制

#### 移动控制
| 按键 | 功能 |
|------|------|
| **W** 或 **↑** | 向上移动 |
| **S** 或 **↓** | 向下移动 |
| **A** 或 **←** | 向左移动 |
| **D** 或 **→** | 向右移动 |

#### 互动控制
| 按键 | 功能 |
|------|------|
| **E** 或 **空格** | 与靠近的 NPC 对话 |
| **ESC** | 关闭对话框 |

### 🖱️ 鼠标控制
- **点击 NPC**：直接点击 NPC 可以开始对话（如果在互动范围内）
- **点击对话框外部**：关闭对话框

### 🎮 游戏流程
1. **移动**：使用 WASD 或方向键在小镇中移动
2. **寻找 NPC**：NPC 会在场景中随机走动
3. **靠近 NPC**：走到 NPC 附近
4. **开始对话**：按 E 键或点击 NPC
5. **输入对话**：在对话框中输入你想说的话
6. **等待回复**：AI 会生成 NPC 的回复（通常需要1-3秒）
7. **继续或离开**：可以继续对话或按 ESC 离开

---

## NPC角色介绍

### 👨‍💻 张三 - Python 工程师

**基本信息**
- **职业**：Python 工程师
- **性格**：技术宅，内向但专业
- **专长**：多智能体系统、HelloAgents 框架、Python 开发、代码优化
- **爱好**：研究算法、写代码、看技术博客

**对话建议**
- ✅ 适合聊的话题：
  - Python 编程技巧
  - 算法和数据结构
  - HelloAgents 框架使用
  - 代码优化方法
  - 最新的技术趋势
  - 开源项目

- ❌ 不太适合的话题：
  - 时尚穿搭
  - 娱乐八卦
  - 情感问题（除非是技术相关）

**性格特点**
- 说话直接，喜欢用技术术语
- 对技术问题非常热情
- 有时会沉浸在自己的世界里
- 喜欢分享技术知识

**对话示例**
- **你**："最近在学 Python，有什么建议吗？"
- **张三**："建议先把基础打牢，多看官方文档。然后可以试试写一些实际项目，比如爬虫或者 Web 应用。记得多看优秀的开源代码，能学到很多东西。"

---

### 👔 李四 - 产品经理

**基本信息**
- **职业**：产品经理
- **性格**：外向健谈，善于沟通协调
- **专长**：产品设计、用户需求分析、项目管理、团队协作
- **爱好**：与人交流、分析用户需求、研究产品案例

**对话建议**
- ✅ 适合聊的话题：
  - 产品设计思路
  - 用户体验优化
  - 项目管理经验
  - 团队协作方法
  - 市场趋势分析
  - 日常生活话题

- ❌ 不太适合的话题：
  - 深入的技术细节
  - 复杂的设计理论

**性格特点**
- 善于倾听和提问
- 喜欢从用户角度思考
- 乐观积极，充满活力
- 擅长协调不同意见

**对话示例**
- **你**："怎么才能做出好的产品？"
- **李四**："关键是理解用户真正的需求！不是他们说什么就做什么，而是要挖掘背后的痛点。多和用户聊，多做用户调研，然后用数据验证你的假设。"

---

### 🎨 王五 - UI 设计师

**基本信息**
- **职业**：UI/UX 设计师
- **性格**：细腻敏感，注重美感和细节
- **专长**：界面设计、用户体验、色彩搭配、视觉设计
- **爱好**：欣赏艺术、喝咖啡、观察生活中的美

**对话建议**
- ✅ 适合聊的话题：
  - 设计理念和方法
  - 色彩搭配技巧
  - 用户界面优化
  - 设计工具使用
  - 艺术和美学
  - 生活中的细节观察

- ❌ 不太适合的话题：
  - 纯技术问题
  - 商业策略（除非涉及设计）

**性格特点**
- 对美的事物敏感
- 说话温和，用词优美
- 注重细节和感受
- 有艺术气质

**对话示例**
- **你**："怎么提升设计审美？"
- **王五**："多观察生活吧，美无处不在。看看自然界的色彩搭配，观察光影的变化，甚至一杯拿铁的颜色过渡都能带来灵感。多看优秀的设计作品，慢慢就能培养出自己的审美。"

---

## 好感度系统详解

### 💖 好感度等级

游戏中的好感度分为 5 个等级：

| 等级 | 分数范围 | 称号 | NPC 态度 |
|------|----------|------|----------|
| **Level 1** | 0-19 | 陌生人 | 冷淡，回答简短 |
| **Level 2** | 20-39 | 认识的人 | 礼貌，正常交流 |
| **Level 3** | 40-59 | 朋友 | 友好，愿意深入交流 |
| **Level 4** | 60-79 | 好友 | 热情，会主动分享 |
| **Level 5** | 80-100 | 挚友 | 亲密，无话不谈 |

### 📈 好感度影响因素

#### ✅ 增加好感度的行为：
1. **话题契合**：聊对方感兴趣的话题
   - 和张三聊技术：+3-5分
   - 和李四聊产品/生活：+3-5分
   - 和王五聊设计/艺术：+3-5分

2. **礼貌用语**：使用礼貌、友好的语言
   - 打招呼、问候：+1-2分
   - 表达感谢：+1-2分
   - 赞美对方：+2-3分

3. **深度交流**：提出有深度的问题
   - 专业问题：+3-5分
   - 个人感受：+2-4分

4. **频繁互动**：经常与 NPC 对话
   - 每次对话：+1分（基础）

#### ❌ 降低好感度的行为：
1. **话题不合**：聊对方不感兴趣的话题
   - 和张三聊八卦：-2-3分
   - 和王五聊深度技术：-2-3分

2. **不礼貌**：使用粗鲁、冒犯的语言
   - 骂人、讽刺：-5-10分
   - 不耐烦的态度：-2-3分

3. **打断/敷衍**：快速离开对话
   - 刚开始就离开：-1分

### 🎁 好感度奖励

不同好感度等级会解锁不同的内容：

- **Level 1 (陌生人)**：
  - 只能进行基础对话
  - NPC 回答简短

- **Level 2 (认识的人)**：
  - 可以聊一些工作相关的话题
  - NPC 会给出更详细的回答

- **Level 3 (朋友)**：
  - 可以聊个人话题
  - NPC 会主动分享一些想法
  - 解锁特殊对话选项

- **Level 4 (好友)**：
  - 可以请教深度问题
  - NPC 会给出更专业的建议
  - NPC 会记住你的喜好

- **Level 5 (挚友)**：
  - 可以聊任何话题
  - NPC 会分享私密想法
  - 获得特殊称呼
  - NPC 会主动关心你

---

## AI对话系统

### 🤖 对话生成流程

1. **用户输入** → 你输入对话内容
2. **发送到后端** → 前端将内容发送到 FastAPI 服务器
3. **AI 处理** → HelloAgents 调用大语言模型生成回复
4. **记忆存储** → 对话内容保存到 SQLite 数据库
5. **返回前端** → 回复显示在游戏中

### 💾 记忆系统

#### 短期记忆
- 保存最近 10 轮对话
- 用于理解上下文
- 让对话连贯自然

#### 长期记忆
- 保存所有重要对话
- 存储在 SQLite 数据库
- NPC 会记住你说过的话
- 影响后续对话内容

#### 记忆示例
**第一次对话**：
- **你**："我最近在学 Python"
- **张三**："哦，Python 很不错，有什么问题可以问我"

**一周后**：
- **你**："最近学习怎么样？"
- **张三**："你的 Python 学得怎么样了？遇到什么困难了吗？"
  ↑ 张三记住了你在学 Python

### 🎭 性格模拟

每个 NPC 的对话由以下要素决定：

1. **角色设定**：职业、性格、专长
2. **对话历史**：过去的交流记录
3. **好感度等级**：影响回复的友好程度
4. **当前情绪**：NPC 的即时状态
5. **上下文**：当前对话的主题

### ⚡ 批量生成系统

为了优化性能和成本，系统使用批量生成：

- **工作原理**：每30秒统一生成一次所有 NPC 的闲聊内容
- **成本优化**：比逐个生成节省约 66% 的 API 调用
- **响应速度**：用户对话仍然是实时生成
- **自然感**：NPC 会自动更新状态和对话

---

## 游戏目标与玩法

### 🎯 短期目标（1小时内）

#### 1. 认识三位 NPC（15分钟）
- [ ] 找到并与张三对话
- [ ] 找到并与李四对话
- [ ] 找到并与王五对话
- [ ] 观察每个 NPC 的性格特点

#### 2. 提升初始好感度（20分钟）
- [ ] 将张三好感度提升到 Level 2
- [ ] 将李四好感度提升到 Level 2
- [ ] 将王五好感度提升到 Level 2
- [ ] 学会针对性话题聊天

#### 3. 测试 AI 能力（15分钟）
- [ ] 测试 NPC 是否记住对话内容
- [ ] 尝试不同类型的话题
- [ ] 观察 NPC 的情绪变化
- [ ] 体验对话的自然度

#### 4. 探索记忆系统（10分钟）
- [ ] 向 NPC 介绍自己
- [ ] 分享一个个人经历
- [ ] 过一段时间后提起之前的话题
- [ ] 验证 NPC 是否记住

---

### 🏆 中期目标（3-5小时）

#### 1. 建立深度关系
- [ ] 将至少一个 NPC 好感度提升到 Level 3
- [ ] 解锁特殊对话选项
- [ ] 获得 NPC 的个人分享

#### 2. 专业学习
- [ ] 向张三学习 Python 知识
- [ ] 向李四学习产品思维
- [ ] 向王五学习设计理念
- [ ] 记录有价值的建议

#### 3. 社交网络
- [ ] 观察 NPC 之间的互动
- [ ] 了解三人的关系
- [ ] 成为团队的一员

#### 4. 个性化体验
- [ ] 建立自己的角色人设
- [ ] 形成固定的对话风格
- [ ] 让 NPC 认识"真正的你"

---

### 👑 长期目标（10+小时）

#### 1. 挚友成就
- [ ] 将所有 NPC 好感度提升到 Level 5
- [ ] 解锁所有特殊对话
- [ ] 成为小镇的核心成员

#### 2. 知识收集
- [ ] 收集 50+ 条技术建议（张三）
- [ ] 收集 50+ 条产品思维（李四）
- [ ] 收集 50+ 条设计灵感（王五）

#### 3. 故事探索
- [ ] 了解每个 NPC 的背景故事
- [ ] 发现 NPC 之间的关系
- [ ] 创造属于你的故事线

#### 4. 系统掌握
- [ ] 完全理解好感度机制
- [ ] 掌握每个 NPC 的性格
- [ ] 能够预测 NPC 的回复风格

---

### 🎨 创意玩法

#### 角色扮演模式
- 给自己设定一个职业和性格
- 始终按照这个人设与 NPC 互动
- 观察 NPC 如何适应你的人设

#### 挑战模式
- **速刷好感**：最快提升好感度到 Level 5
- **话题大师**：与每个 NPC 聊遍所有可能的话题
- **记忆测试**：测试 NPC 能记住多少内容

#### 实验模式
- **性格测试**：用不同的方式对话，观察 NPC 反应
- **边界探索**：测试 AI 的回答范围和能力
- **情境模拟**：创造特定场景，观察 NPC 应对

#### 学习模式
- **技术提升**：把游戏当做学习工具，向 NPC 请教真实问题
- **记笔记**：记录 NPC 的建议和知识点
- **定期复习**：过几天再与 NPC 讨论同样的话题，看是否有新收获

---

## 高级技巧

### 💡 对话技巧

#### 1. 如何快速提升好感度
```
✅ 有效方法：
1. 先打招呼，再进入正题
   示例："你好张三！最近在忙什么呢？"
   
2. 针对性话题，展现兴趣
   示例："我对 Python 的装饰器不太理解，能给我讲讲吗？"
   
3. 积极回应，表达感谢
   示例："太感谢了！你的解释很清楚，我明白了！"
   
4. 分享个人经历，建立连接
   示例："我也遇到过类似的问题，后来我..."
   
5. 定期互动，保持联系
   建议：每个游戏日都和每位 NPC 聊至少一次
```

#### 2. 对话深度技巧
```
Level 1 → Level 2：
- 礼貌问候
- 询问基本信息
- 表达兴趣

Level 2 → Level 3：
- 聊专业话题
- 提出有深度的问题
- 分享自己的想法

Level 3 → Level 4：
- 请教个人建议
- 讨论复杂问题
- 建立共同话题

Level 4 → Level 5：
- 分享私密想法
- 深入情感交流
- 形成独特的互动方式
```

#### 3. 避免好感度下降
```
❌ 不要做的事：
1. 不要粗鲁或不礼貌
2. 不要强行聊不相关的话题
3. 不要重复问同样的问题（除非是故意测试记忆）
4. 不要打断对话就离开
5. 不要长时间不互动
```

### 🎯 最佳实践

#### 每日游戏流程（建议）

**第一步：打招呼（5分钟）**
- 依次找到三位 NPC
- 简单问候，了解他们的状态
- 观察他们的自动对话

**第二步：深度交流（20分钟）**
- 选择一位 NPC 进行深入对话
- 聊 5-10 轮，建立话题
- 注意观察好感度变化

**第三步：轮流互动（15分钟）**
- 与其他 NPC 也进行交流
- 保持关系平衡
- 避免冷落某个 NPC

**第四步：自由探索（10分钟）**
- 尝试新的话题
- 测试 AI 的能力
- 观察 NPC 的自主行为

#### 对话模板

**首次见面**：
```
"你好！我是 [你的名字]，很高兴认识你！你平时主要做什么工作呢？"
```

**建立连接**：
```
"我对 [NPC的专业领域] 很感兴趣，你能给我一些建议吗？"
```

**深化关系**：
```
"上次你提到的 [之前的话题]，我试了试，效果不错！你还有其他建议吗？"
```

**保持联系**：
```
"好久不见！最近怎么样？有什么新的想法吗？"
```

---

## 系统监控与调试

### 📊 查看后端状态

#### 访问 API 文档
打开浏览器访问：http://localhost:8000/docs

你可以看到：
- 所有 API 接口
- NPC 状态查询
- 对话历史记录
- 好感度数据

#### 主要 API 端点

| 端点 | 功能 | 示例 |
|------|------|------|
| `GET /npcs` | 获取所有 NPC 状态 | http://localhost:8000/npcs |
| `POST /dialogue` | 发送对话请求 | （需要 body 参数）|
| `GET /affinity/{npc_name}` | 查看指定 NPC 好感度 | http://localhost:8000/affinity/张三 |

### 📝 查看对话日志

对话日志保存在：
```
C:\Users\frankechen\CFP-Study\Task06\official-code\code\chapter15\Helloagents-AI-Town\backend\logs\dialogue_2025-12-27.log
```

用文本编辑器打开可以看到：
- 每次对话的时间戳
- 对话内容
- AI 生成的回复
- 好感度变化

### 🔍 调试技巧

#### 1. 检查后端是否运行
```powershell
# PowerShell 命令
Test-NetConnection -ComputerName localhost -Port 8000
```
如果返回 `True`，说明后端正常运行

#### 2. 查看 NPC 实时状态
访问：http://localhost:8000/npcs

你会看到类似的 JSON 数据：
```json
{
  "张三": {
    "current_dialogue": "今天代码写得挺顺利的",
    "affinity_level": 2,
    "last_update": "2025-12-27 18:00:00"
  },
  ...
}
```

#### 3. 手动测试对话
在浏览器中访问 API 文档（http://localhost:8000/docs），可以手动发送对话请求测试

---

## 常见问题解答

### ❓ 游戏相关

**Q1: NPC 为什么不回复我？**
- 检查后端服务是否运行（访问 http://localhost:8000/docs）
- 查看后端窗口是否有错误信息
- API 调用可能超时，等待几秒后重试
- 检查网络连接（需要访问 SiliconFlow API）

**Q2: NPC 的回复很慢怎么办？**
- 正常情况下需要 1-3 秒
- 如果超过 10 秒，可能是网络问题
- 可以刷新游戏重试
- 检查 API key 是否有效

**Q3: 好感度怎么提升这么慢？**
- 确保聊的是 NPC 感兴趣的话题
- 使用礼貌、友好的语言
- 提出有深度的问题
- 频繁互动（但不要刷屏）

**Q4: NPC 会记住我说的话吗？**
- 会！系统有完整的记忆系统
- 短期记忆：最近 10 轮对话
- 长期记忆：所有重要对话
- 可以通过提起之前的话题来测试

**Q5: 可以同时与多个 NPC 对话吗？**
- 游戏设计上同一时间只能与一个 NPC 对话
- 但可以快速切换对话对象
- NPC 会各自记住与你的对话

### ❓ 技术相关

**Q6: 游戏卡顿怎么办？**
- 关闭其他占用 GPU 的程序
- 降低 Godot 的渲染质量
- 检查后端 CPU 使用率

**Q7: 如何重置游戏进度？**
```powershell
# 删除记忆数据库（慎用！）
Remove-Item -Path "C:\Users\frankechen\CFP-Study\Task06\official-code\code\chapter15\Helloagents-AI-Town\backend\memory_data" -Recurse -Force

# 重启后端服务即可
```

**Q8: 如何更换 AI 模型？**
编辑后端 `.env` 文件：
```ini
LLM_MODEL_ID=Qwen/Qwen2.5-7B-Instruct  # 修改这一行
```

**Q9: 如何查看 API 使用量？**
- 登录 SiliconFlow 控制台
- 查看 API 调用统计
- 每次对话大约消耗 1000-2000 tokens

**Q10: 游戏数据保存在哪里？**
- **记忆数据**：`backend/memory_data/`
- **对话日志**：`backend/logs/`
- **好感度数据**：SQLite 数据库
- **游戏设置**：Godot 项目文件

---

## 🎓 学习建议

### 第一周：熟悉基础
- [ ] 完成所有短期目标
- [ ] 理解三位 NPC 的性格
- [ ] 掌握基本对话技巧
- [ ] 达到至少一个 Level 3 好感度

### 第二周：深入探索
- [ ] 完成所有中期目标
- [ ] 测试 AI 的各种能力
- [ ] 形成自己的对话风格
- [ ] 达到至少一个 Level 4 好感度

### 第三周：完全掌握
- [ ] 完成所有长期目标
- [ ] 所有 NPC 达到 Level 5
- [ ] 理解整个系统架构
- [ ] 准备改进和扩展游戏

---

## 🌟 最佳体验建议

### 心态调整
- **放松心情**：这是一个休闲游戏，不要有压力
- **真诚交流**：把 NPC 当做真实的朋友
- **保持好奇**：尝试各种对话可能性
- **享受过程**：重点是体验 AI 技术的魅力

### 时间安排
- **每次游玩**：建议 30-60 分钟
- **游玩频率**：每天或每隔一天
- **持续时间**：至少玩 1-2 周才能充分体验

### 记录与分享
- 记录有趣的对话
- 截图精彩时刻
- 分享你的发现
- 记录 AI 的"智慧时刻"

---

## 📚 进阶阅读

学完游戏基础后，可以：

1. **阅读代码**：
   - 查看 `backend/agents.py` 了解 NPC 实现
   - 查看 `frontend/scripts/` 了解游戏逻辑

2. **学习 AI 技术**：
   - HelloAgents 框架文档
   - 大语言模型原理
   - 提示工程（Prompt Engineering）

3. **改进游戏**：
   - 参考《赛博小镇-游戏改进指南.md》
   - 添加新功能
   - 优化用户体验

---

## 🎮 开始你的旅程吧！

现在你已经掌握了所有玩法，准备好进入赛博小镇了吗？

**记住**：这是一个由 AI 驱动的游戏，每次对话都是独一无二的。尽情探索，享受与 AI NPC 互动的乐趣吧！

**祝你玩得开心！** 🎉

---

*游戏指南版本：v1.0*  
*最后更新：2025-12-27*  
*作者：CodeBuddy AI Assistant*
