# 如何保持 DeepResearch Agent 服务持续运行

**创建日期**: 2025-12-26  
**问题**: 服务运行一段时间后自动停止

---

## 🎯 问题说明

当前通过 CodeBuddy 启动的后台服务有时间限制，可能会在一段时间后自动停止。要让服务持续运行，需要**手动启动**。

---

## ✅ 推荐方案（3种方式）

### 方式 1: 使用批处理脚本启动（最简单）⭐⭐⭐⭐⭐

**步骤**:
1. 打开文件资源管理器
2. 进入目录: `C:\Users\frankechen\CFP-Study\Task06\official-code\code\chapter14\helloagents-deepresearch\`
3. 双击运行: **快速启动.bat**
4. 会打开两个命令窗口（不要关闭）
5. 按任意键，浏览器自动打开
6. 开始使用！

**重要**: 
- ✅ 两个命令窗口会一直保持打开状态
- ✅ 只要窗口不关闭，服务就会持续运行
- ✅ 可以最小化窗口，但不要关闭

---

### 方式 2: 创建桌面快捷方式（最方便）⭐⭐⭐⭐⭐

**一次性设置**:
1. 进入目录: `C:\Users\frankechen\CFP-Study\Task06\official-code\code\chapter14\helloagents-deepresearch\`
2. 双击运行: **创建桌面快捷方式.bat**
3. 桌面会出现 "DeepResearch启动" 图标

**日常使用**:
- 双击桌面的 "DeepResearch启动" 图标
- 等待服务启动完成
- 开始使用！

---

### 方式 3: 手动命令行启动（适合高级用户）

**启动后端**:
```cmd
打开命令提示符 (Win + R, 输入 cmd)
cd C:\Users\frankechen\CFP-Study\Task06\official-code\code\chapter14\helloagents-deepresearch\backend
python src\main.py
```

**启动前端**:
```cmd
打开新的命令提示符
cd C:\Users\frankechen\CFP-Study\Task06\official-code\code\chapter14\helloagents-deepresearch\frontend
npm run dev
```

**重要**: 保持两个命令提示符窗口打开

---

## 📋 服务管理指南

### 启动服务后

```
✅ 正常状态:
   - 两个命令窗口保持打开
   - 可以看到实时日志输出
   - 访问 http://localhost:5174 正常

⚠️ 注意事项:
   - 不要关闭命令窗口
   - 可以最小化到任务栏
   - 电脑休眠后需要重启服务
```

### 停止服务

**方式 1**: 关闭命令窗口
- 直接关闭两个服务窗口即可

**方式 2**: 使用停止脚本
- 双击运行: `停止所有服务.bat`

**方式 3**: 按 Ctrl+C
- 在命令窗口中按 Ctrl+C 停止

---

## 🔍 如何检查服务是否在运行

### 方法 1: 访问网页
```
打开浏览器，访问:
- http://localhost:5174  (前端界面)
- http://localhost:8000/healthz  (后端健康检查)
```

### 方法 2: 查看进程
```
打开任务管理器 (Ctrl+Shift+Esc)
查找进程:
- python.exe  (后端)
- node.exe    (前端)
```

### 方法 3: 命令行检查
```cmd
netstat -ano | findstr "8000 5174"
```
应该看到监听端口的输出

---

## 🚀 完整启动流程示意图

```
┌─────────────────────────────┐
│  双击 "快速启动.bat"          │
│  或 "DeepResearch启动" 快捷方式│
└──────────┬──────────────────┘
           │
           ↓
┌─────────────────────────────┐
│  打开两个命令窗口             │
│  ▪ 后端窗口 (蓝色)            │
│  ▪ 前端窗口 (紫色)            │
└──────────┬──────────────────┘
           │
           ↓
┌─────────────────────────────┐
│  等待 10 秒左右               │
│  (查看窗口中的启动日志)        │
└──────────┬──────────────────┘
           │
           ↓
┌─────────────────────────────┐
│  看到 "服务启动完成"          │
│  按任意键                    │
└──────────┬──────────────────┘
           │
           ↓
┌─────────────────────────────┐
│  浏览器自动打开               │
│  http://localhost:5174       │
└──────────┬──────────────────┘
           │
           ↓
┌─────────────────────────────┐
│  开始使用！                  │
│  (保持窗口开启)              │
└─────────────────────────────┘
```

---

## ⚠️ 常见问题

### Q1: 窗口一闪而过，服务没有启动

**原因**: 环境配置问题

**解决**:
1. 确保 Python 已安装: `python --version`
2. 确保 Node.js 已安装: `node --version`
3. 使用 "启动所有服务.bat"（会显示详细错误）

### Q2: 启动后过一会就连接不上了

**原因**: 命令窗口被关闭了

**解决**:
- 检查任务栏是否还有服务窗口
- 如果窗口关闭了，重新运行启动脚本
- 确保不要误关窗口

### Q3: 电脑休眠后服务停止

**正常现象**: 电脑休眠会停止所有运行的程序

**解决**:
- 唤醒电脑后重新运行启动脚本
- 或设置电脑不休眠（控制面板 → 电源选项）

### Q4: 端口被占用

**现象**: 提示 "Address already in use"

**解决**:
1. 运行 "停止所有服务.bat"
2. 等待 5 秒
3. 重新启动

---

## 💡 最佳实践

### 1. 使用桌面快捷方式
```
✅ 优点:
   - 一键启动，最方便
   - 不需要记住路径
   - 可以固定到任务栏

📝 操作:
   运行 "创建桌面快捷方式.bat"（只需一次）
```

### 2. 保持窗口最小化
```
✅ 启动后:
   - 将两个命令窗口最小化到任务栏
   - 保持桌面整洁
   - 需要查看日志时再恢复
```

### 3. 设置开机自启动（可选）
```
如果需要开机自动启动:
1. Win + R，输入: shell:startup
2. 将 "DeepResearch启动.lnk" 复制到此文件夹
3. 重启电脑，服务会自动启动
```

### 4. 定期检查服务状态
```
养成习惯:
- 使用前访问 http://localhost:8000/healthz
- 确认返回 {"status":"ok"}
- 如果不正常，重启服务
```

---

## 🎮 服务控制命令速查

| 操作 | 方法 |
|-----|------|
| **启动服务** | 双击 `快速启动.bat` 或桌面快捷方式 |
| **停止服务** | 关闭命令窗口 或 运行 `停止所有服务.bat` |
| **重启服务** | 运行 `重启所有服务.bat` |
| **查看后端日志** | 查看后端命令窗口 |
| **查看前端日志** | 查看前端命令窗口 |
| **检查状态** | 访问 http://localhost:8000/healthz |

---

## 📊 当前服务状态

### 现在的服务信息

```
🟢 后端服务
   - 地址: http://localhost:8000
   - 进程ID: 33632
   - 状态: 运行中

🟢 前端服务
   - 地址: http://localhost:5174
   - 进程ID: 44192
   - 状态: 运行中

✅ 可以立即访问: http://localhost:5174
```

**注意**: 这些服务是通过 CodeBuddy 的后台进程启动的，可能会在一段时间后停止。建议使用上面的方式手动启动以保持持续运行。

---

## 🔧 故障排除流程

```
服务无法访问
    ↓
检查窗口是否还在运行
    ↓
    ├─ 是 → 检查浏览器地址是否正确
    │         http://localhost:5174
    │
    └─ 否 → 重新启动服务
            ↓
            双击 "快速启动.bat"
            ↓
            等待启动完成
            ↓
            访问 http://localhost:5174
```

---

## 📱 移动办公提示

如果需要在不同地点使用:

1. **确保文件同步**
   - 使用 Git 或云盘同步项目
   - 确保 `.env` 配置文件存在

2. **环境依赖**
   - 确保新电脑安装了 Python 和 Node.js
   - 运行一次 `npm install` 安装依赖

3. **快速部署**
   - 复制整个项目目录
   - 运行启动脚本即可

---

## ✅ 总结

要让服务持续运行:

1. ⭐ **推荐**: 双击 "快速启动.bat" 或使用桌面快捷方式
2. ✅ **保持**: 两个命令窗口不要关闭
3. 🔍 **监控**: 定期检查服务状态
4. 🔄 **重启**: 遇到问题直接重启服务

**核心要点**: 只要命令窗口保持打开，服务就会一直运行！

---

**最后更新**: 2025-12-26  
**当前状态**: ✅ 服务正在运行，可以使用
