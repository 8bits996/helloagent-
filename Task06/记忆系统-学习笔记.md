# è®°å¿†ç³»ç»Ÿ - å­¦ä¹ ç¬”è®°

**æ—¥æœŸ**: 2025-12-28  
**å­¦ä¹ è€…**: Franke Chen

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

è®°å¿†ç³»ç»Ÿè®©NPCèƒ½å¤Ÿ"è®°ä½"ä¹‹å‰çš„å¯¹è¯ï¼Œä½¿å¯¹è¯æ›´åŠ **è¿è´¯**å’Œ**ä¸ªæ€§åŒ–**ã€‚è¿™æ˜¯AI Agentè¶…è¶Šä¼ ç»ŸèŠå¤©æœºå™¨äººçš„å…³é”®ç‰¹æ€§ã€‚

---

## ğŸ§  åŒå±‚è®°å¿†æ¶æ„

èµ›åšå°é•‡ä½¿ç”¨äº†**åŒå±‚è®°å¿†ç»“æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å·¥ä½œè®°å¿† (Working Memory)         â”‚  çŸ­æœŸã€æœ€è¿‘çš„å¯¹è¯
â”‚   - å®¹é‡: æœ€è¿‘10æ¡å¯¹è¯               â”‚  
â”‚   - Tokené™åˆ¶: 2000 tokens          â”‚
â”‚   - ä½œç”¨: ä¿æŒå¯¹è¯è¿è´¯æ€§             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æƒ…æ™¯è®°å¿† (Episodic Memory)        â”‚  é•¿æœŸã€é‡è¦çš„å¯¹è¯
â”‚   - å®¹é‡: æœ€å¤š100æ¡                  â”‚
â”‚   - æ£€ç´¢: åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦             â”‚
â”‚   - ä½œç”¨: é•¿æœŸå…³ç³»è®°å¿†               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸ºä»€ä¹ˆéœ€è¦ä¸¤å±‚ï¼Ÿ

- **å·¥ä½œè®°å¿†**: åƒäººç±»çš„"çŸ­æœŸè®°å¿†"ï¼Œè®°ä½æœ€è¿‘å‡ è½®å¯¹è¯
- **æƒ…æ™¯è®°å¿†**: åƒäººç±»çš„"é•¿æœŸè®°å¿†"ï¼Œè®°ä½é‡è¦çš„å†å²äº‹ä»¶

---

## ğŸ“Š è®°å¿†ç³»ç»Ÿå·¥ä½œæµç¨‹

```
1. ç©å®¶å‘é€æ¶ˆæ¯
   â†“
2. æ£€ç´¢ç›¸å…³è®°å¿†
   - ä»å·¥ä½œè®°å¿†ä¸­è·å–æœ€è¿‘å¯¹è¯
   - ä»æƒ…æ™¯è®°å¿†ä¸­æ£€ç´¢è¯­ä¹‰ç›¸å…³çš„å†å²å¯¹è¯
   â†“
3. æ„å»ºå¢å¼ºæç¤ºè¯
   - ç³»ç»Ÿæç¤ºè¯ (è§’è‰²è®¾å®š)
   - å¥½æ„Ÿåº¦ä¸Šä¸‹æ–‡
   - è®°å¿†ä¸Šä¸‹æ–‡ (ä¹‹å‰çš„å¯¹è¯)
   - å½“å‰æ¶ˆæ¯
   â†“
4. LLMç”Ÿæˆå›å¤
   (åŸºäºå®Œæ•´ä¸Šä¸‹æ–‡)
   â†“
5. ä¿å­˜æ–°å¯¹è¯åˆ°è®°å¿†
   - æ·»åŠ åˆ°å·¥ä½œè®°å¿†
   - æ ¹æ®é‡è¦æ€§å†³å®šæ˜¯å¦å­˜å…¥æƒ…æ™¯è®°å¿†
   â†“
6. è¿”å›å›å¤
```

---

## ğŸ’» ä»£ç å®ç°è§£æ

### 1. è®°å¿†ç®¡ç†å™¨åˆå§‹åŒ–

**æ–‡ä»¶**: `backend/agents.py:140-168`

```python
def _create_memory_manager(self, npc_name: str) -> MemoryManager:
    # 1. åˆ›å»ºå­˜å‚¨ç›®å½•
    memory_dir = os.path.join(..., 'memory_data', npc_name)
    
    # 2. é…ç½®è®°å¿†ç³»ç»Ÿ
    memory_config = MemoryConfig(
        storage_path=memory_dir,
        working_memory_capacity=10,      # æœ€è¿‘10æ¡å¯¹è¯
        working_memory_tokens=2000,      # æœ€å¤š2000ä¸ªtoken
        episodic_memory_capacity=100,    # æœ€å¤š100æ¡é•¿æœŸè®°å¿†
        enable_forgetting=True,          # å¯ç”¨é—å¿˜æœºåˆ¶
        forgetting_threshold=0.3         # é‡è¦æ€§<0.3ä¼šè¢«é—å¿˜
    )
    
    # 3. åˆ›å»ºè®°å¿†ç®¡ç†å™¨
    memory_manager = MemoryManager(
        config=memory_config,
        user_id=npc_name,
        enable_working=True,    # âœ… å¯ç”¨å·¥ä½œè®°å¿†
        enable_episodic=True,   # âœ… å¯ç”¨æƒ…æ™¯è®°å¿†
        enable_semantic=False,  # âŒ ä¸éœ€è¦è¯­ä¹‰è®°å¿†
        enable_perceptual=False # âŒ ä¸éœ€è¦æ„ŸçŸ¥è®°å¿†
    )
    
    return memory_manager
```

#### å…³é”®å‚æ•°è¯´æ˜

| å‚æ•° | å€¼ | è¯´æ˜ |
|-----|---|------|
| `working_memory_capacity` | 10 | ä¿ç•™æœ€è¿‘10æ¡å¯¹è¯ |
| `working_memory_tokens` | 2000 | é™åˆ¶tokenæ•°é‡ï¼Œé¿å…è¶…å‡ºLLMä¸Šä¸‹æ–‡çª—å£ |
| `episodic_memory_capacity` | 100 | æœ€å¤šä¿å­˜100æ¡é•¿æœŸè®°å¿† |
| `enable_forgetting` | True | è‡ªåŠ¨é—å¿˜ä¸é‡è¦çš„è®°å¿† |
| `forgetting_threshold` | 0.3 | é‡è¦æ€§ä½äº0.3çš„è®°å¿†ä¼šè¢«é—å¿˜ |

---

### 2. è®°å¿†æ£€ç´¢

**æ–‡ä»¶**: `backend/agents.py:201-210`

```python
# æ£€ç´¢ç›¸å…³è®°å¿†
relevant_memories = memory_manager.retrieve_memories(
    query=message,                      # ç©å®¶çš„å½“å‰æ¶ˆæ¯
    memory_types=["working", "episodic"],  # ä»ä¸¤ç§è®°å¿†ä¸­æ£€ç´¢
    limit=5,                           # æœ€å¤šè¿”å›5æ¡è®°å¿†
    min_importance=0.3                 # åªæ£€ç´¢é‡è¦æ€§>=0.3çš„è®°å¿†
)
```

#### æ£€ç´¢æœºåˆ¶

1. **è¯­ä¹‰æ£€ç´¢**: ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦åŒ¹é…ç›¸å…³å¯¹è¯
2. **é‡è¦æ€§è¿‡æ»¤**: åªæ£€ç´¢é‡è¦çš„è®°å¿†ï¼ˆimportance >= 0.3ï¼‰
3. **æ•°é‡é™åˆ¶**: æœ€å¤šè¿”å›5æ¡ï¼Œé¿å…æç¤ºè¯è¿‡é•¿

---

### 3. æ„å»ºè®°å¿†ä¸Šä¸‹æ–‡

**æ–‡ä»¶**: `backend/agents.py:263-276`

```python
def _build_memory_context(self, memories: List[MemoryItem]) -> str:
    if not memories:
        return ""
    
    context_parts = ["ã€ä¹‹å‰çš„å¯¹è¯è®°å¿†ã€‘"]
    for memory in memories:
        time_str = memory.timestamp.strftime("%H:%M")
        context_parts.append(f"[{time_str}] {memory.content}")
    
    return "\n".join(context_parts)
```

#### è¾“å‡ºç¤ºä¾‹

```
ã€ä¹‹å‰çš„å¯¹è¯è®°å¿†ã€‘
[14:23] ç©å®¶è¯´: ä½ å¥½ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ï¼
[14:23] æˆ‘å›å¤: ä½ å¥½ï¼æˆ‘ä¹Ÿå¾ˆé«˜å…´è®¤è¯†ä½ ã€‚
[14:25] ç©å®¶è¯´: èƒ½æ•™æ•™æˆ‘Pythonå—ï¼Ÿ
[14:25] æˆ‘å›å¤: å½“ç„¶å¯ä»¥ï¼æˆ‘å¾ˆä¹æ„åˆ†äº«æˆ‘çš„ç»éªŒã€‚

ã€å½“å‰å¯¹è¯ã€‘
ç©å®¶: è¿˜è®°å¾—æˆ‘ä¹‹å‰é—®ä½ çš„Pythoné—®é¢˜å—ï¼Ÿ
```

è¿™æ ·ï¼ŒNPCå°±èƒ½"è®°ä½"ä¹‹å‰çš„å¯¹è¯ï¼

---

### 4. ä¿å­˜å¯¹è¯åˆ°è®°å¿†

**æ–‡ä»¶**: `backend/agents.py:278-323`

```python
def _save_conversation_to_memory(
    self, memory_manager, npc_name, player_message, 
    npc_response, player_id, affinity_info=None
):
    current_time = datetime.now()
    
    # 1. ä¿å­˜ç©å®¶æ¶ˆæ¯
    memory_manager.add_memory(
        content=f"ç©å®¶è¯´: {player_message}",
        memory_type="working",      # å…ˆå­˜å…¥å·¥ä½œè®°å¿†
        importance=0.5,             # ä¸­ç­‰é‡è¦æ€§
        timestamp=current_time,
        metadata={
            "speaker": "player",
            "player_id": player_id,
            "affinity": affinity,
            "sentiment": sentiment
        }
    )
    
    # 2. ä¿å­˜NPCå›å¤
    memory_manager.add_memory(
        content=f"æˆ‘å›å¤: {npc_response}",
        memory_type="working",
        importance=0.5,
        timestamp=current_time,
        metadata={
            "speaker": npc_name,
            "affinity": affinity,
            "affinity_change": affinity_change
        }
    )
```

#### è®°å¿†å…ƒæ•°æ®

æ¯æ¡è®°å¿†éƒ½åŒ…å«ä¸°å¯Œçš„å…ƒæ•°æ®ï¼š

- `speaker`: è¯´è¯è€…ï¼ˆç©å®¶æˆ–NPCï¼‰
- `player_id`: ç©å®¶IDï¼ˆæ”¯æŒå¤šç©å®¶ï¼‰
- `affinity`: å½“æ—¶çš„å¥½æ„Ÿåº¦
- `sentiment`: æƒ…æ„Ÿå€¾å‘ï¼ˆpositive/neutral/negativeï¼‰
- `affinity_change`: å¥½æ„Ÿåº¦å˜åŒ–é‡

---

## ğŸ® æ¸¸æˆä¸­æµ‹è¯•è®°å¿†ç³»ç»Ÿ

### æµ‹è¯•åœºæ™¯1: çŸ­æœŸè®°å¿†ï¼ˆå·¥ä½œè®°å¿†ï¼‰

**ç¬¬1è½®å¯¹è¯**:
```
ğŸ‘¤ "ä½ å¥½ï¼Œæˆ‘å«å°æ˜"
ğŸ¤– "ä½ å¥½å°æ˜ï¼æˆ‘æ˜¯å¼ ä¸‰ï¼ŒPythonå·¥ç¨‹å¸ˆã€‚"
ğŸ’¾ [ä¿å­˜] å·¥ä½œè®°å¿†: "ç©å®¶è¯´: ä½ å¥½ï¼Œæˆ‘å«å°æ˜"
```

**ç¬¬2è½®å¯¹è¯ï¼ˆ5åˆ†é’Ÿåï¼‰**:
```
ğŸ‘¤ "æˆ‘æ˜¯è°ï¼Ÿ"
ğŸ¤– "ä½ æ˜¯å°æ˜å•Šï¼æˆ‘ä»¬åˆšåˆšè®¤è¯†çš„ã€‚"
ğŸ’¾ [æ£€ç´¢] ä»å·¥ä½œè®°å¿†ä¸­æ‰¾åˆ°: "ç©å®¶è¯´: ä½ å¥½ï¼Œæˆ‘å«å°æ˜"
```

### æµ‹è¯•åœºæ™¯2: é•¿æœŸè®°å¿†ï¼ˆæƒ…æ™¯è®°å¿†ï¼‰

**ç¬¬1å¤©å¯¹è¯**:
```
ğŸ‘¤ "æˆ‘åœ¨å­¦ä¹ Pythonï¼Œä½ èƒ½æ¨èä¸€äº›èµ„æºå—ï¼Ÿ"
ğŸ¤– "å½“ç„¶ï¼æˆ‘æ¨èä½ çœ‹ã€Šæµç•…çš„Pythonã€‹..."
ğŸ’¾ [ä¿å­˜] é‡è¦æ€§: 0.8 (å› ä¸ºæ¶‰åŠä¸“ä¸šè¯é¢˜)
```

**ç¬¬2å¤©å¯¹è¯ï¼ˆ24å°æ—¶åï¼‰**:
```
ğŸ‘¤ "å—¨ï¼Œè¿˜è®°å¾—æˆ‘åœ¨å­¦ä»€ä¹ˆå—ï¼Ÿ"
ğŸ¤– "å½“ç„¶è®°å¾—ï¼ä½ åœ¨å­¦Pythonï¼Œæˆ‘è¿˜æ¨èäº†ã€Šæµç•…çš„Pythonã€‹ç»™ä½ ã€‚å­¦å¾—æ€ä¹ˆæ ·äº†ï¼Ÿ"
ğŸ’¾ [æ£€ç´¢] ä»æƒ…æ™¯è®°å¿†ä¸­æ‰¾åˆ°ç›¸å…³å¯¹è¯
```

### æµ‹è¯•åœºæ™¯3: é—å¿˜æœºåˆ¶

```
æ™®é€šé—²èŠï¼ˆé‡è¦æ€§: 0.2ï¼‰:
ğŸ‘¤ "ä»Šå¤©å¤©æ°”ä¸é”™"
ğŸ¤– "æ˜¯å•Šï¼ŒæŒºå¥½çš„"
ğŸ’¾ [ä¿å­˜] é‡è¦æ€§: 0.2 â†’ å¾ˆå¿«ä¼šè¢«é—å¿˜

é‡è¦å¯¹è¯ï¼ˆé‡è¦æ€§: 0.8ï¼‰:
ğŸ‘¤ "æˆ‘æ˜å¤©è¦é¢è¯•Pythonå²—ä½ï¼Œç´§å¼ ..."
ğŸ¤– "åˆ«ç´§å¼ ï¼æˆ‘ç»™ä½ ä¸€äº›é¢è¯•å»ºè®®..."
ğŸ’¾ [ä¿å­˜] é‡è¦æ€§: 0.8 â†’ é•¿æœŸä¿ç•™
```

---

## ğŸ’¡ è®¾è®¡äº®ç‚¹

### 1. è¯­ä¹‰æ£€ç´¢ vs å…³é”®è¯åŒ¹é…

**ä¼ ç»Ÿæ–¹å¼ï¼ˆå…³é”®è¯ï¼‰**:
```
ç©å®¶: "ä½ è¿˜è®°å¾—æˆ‘ä»¬èŠè¿‡Pythonå—ï¼Ÿ"
âŒ æœç´¢å…³é”®è¯ "Python" â†’ æ‰¾åˆ°æ‰€æœ‰æåˆ°Pythonçš„å¯¹è¯ï¼ˆå¯èƒ½æ— å…³ï¼‰
```

**èµ›åšå°é•‡ï¼ˆè¯­ä¹‰ï¼‰**:
```
ç©å®¶: "ä½ è¿˜è®°å¾—æˆ‘ä»¬èŠè¿‡Pythonå—ï¼Ÿ"
âœ… è¯­ä¹‰æ£€ç´¢ â†’ æ‰¾åˆ°"Pythonå­¦ä¹ "ç›¸å…³çš„å¯¹è¯ï¼ˆæ›´å‡†ç¡®ï¼‰
```

### 2. é‡è¦æ€§è¯„åˆ†

ä¸æ˜¯æ‰€æœ‰å¯¹è¯éƒ½å€¼å¾—è®°å¿†ï¼š

```python
# è‡ªåŠ¨è¯„ä¼°é‡è¦æ€§
if "è¯·æ•™" in message or "å­¦ä¹ " in message:
    importance = 0.8  # é«˜é‡è¦æ€§
elif "å¤©æ°”" in message or "é—²èŠ" in message:
    importance = 0.2  # ä½é‡è¦æ€§
```

### 3. ä¸å¥½æ„Ÿåº¦ç³»ç»Ÿé›†æˆ

è®°å¿†ä¸ä»…ä¿å­˜å¯¹è¯å†…å®¹ï¼Œè¿˜ä¿å­˜**å½“æ—¶çš„å…³ç³»çŠ¶æ€**ï¼š

```python
metadata = {
    "affinity": 65.0,           # å½“æ—¶å¥½æ„Ÿåº¦65åˆ†
    "affinity_change": +5,      # è¿™æ¬¡å¯¹è¯+5åˆ†
    "sentiment": "positive"     # æ­£é¢æƒ…æ„Ÿ
}
```

è¿™æ ·ï¼ŒNPCä¸ä»…è®°å¾—"è¯´äº†ä»€ä¹ˆ"ï¼Œè¿˜è®°å¾—"å½“æ—¶å…³ç³»å¦‚ä½•"ã€‚

### 4. å¤šç©å®¶æ”¯æŒ

æ¯ä¸ªç©å®¶æœ‰ç‹¬ç«‹çš„è®°å¿†ï¼š

```python
# ç©å®¶Açš„å¯¹è¯
memory_manager.add_memory(..., metadata={"player_id": "player_A"})

# ç©å®¶Bçš„å¯¹è¯
memory_manager.add_memory(..., metadata={"player_id": "player_B"})
```

NPCå¯¹ä¸åŒç©å®¶æœ‰ä¸åŒçš„è®°å¿†å’Œå…³ç³»ï¼

---

## ğŸ¯ å­¦ä¹ è¦ç‚¹

### ç†è®ºå±‚é¢

1. âœ… ç†è§£åŒå±‚è®°å¿†æ¶æ„çš„è®¾è®¡
2. âœ… ç†è§£å·¥ä½œè®°å¿† vs æƒ…æ™¯è®°å¿†çš„åŒºåˆ«
3. âœ… ç†è§£è¯­ä¹‰æ£€ç´¢çš„ä¼˜åŠ¿
4. âœ… ç†è§£é—å¿˜æœºåˆ¶çš„å¿…è¦æ€§

### å®ç°å±‚é¢

1. âœ… MemoryManager çš„é…ç½®å’Œä½¿ç”¨
2. âœ… retrieve_memories() çš„æ£€ç´¢æœºåˆ¶
3. âœ… add_memory() çš„ä¿å­˜æœºåˆ¶
4. âœ… è®°å¿†å…ƒæ•°æ®çš„è®¾è®¡

### åº”ç”¨å±‚é¢

1. âœ… å¦‚ä½•è®©å¯¹è¯æ›´è¿è´¯
2. âœ… å¦‚ä½•è®©NPC"è®°ä½"é‡è¦ä¿¡æ¯
3. âœ… å¦‚ä½•å¹³è¡¡è®°å¿†å®¹é‡å’Œæ€§èƒ½
4. âœ… å¦‚ä½•ä¸å¥½æ„Ÿåº¦ç³»ç»ŸååŒå·¥ä½œ

---

## ğŸš€ æ‰©å±•æ€è·¯

### å¯èƒ½çš„æ”¹è¿›æ–¹å‘

1. **è®°å¿†ä¼˜å…ˆçº§**
   - é‡è¦å¯¹è¯ä¼˜å…ˆä¿ç•™
   - å®šæœŸæ¸…ç†ä¸é‡è¦çš„è®°å¿†

2. **è®°å¿†æ€»ç»“**
   - å®šæœŸç”¨LLMæ€»ç»“å†å²å¯¹è¯
   - å­˜å‚¨æ€»ç»“è€ŒéåŸå§‹å¯¹è¯ï¼ˆèŠ‚çœtokenï¼‰

3. **å…±äº«è®°å¿†**
   - NPCä¹‹é—´å¯ä»¥å…±äº«æŸäº›è®°å¿†
   - ä¾‹å¦‚ï¼šå¼ ä¸‰å‘Šè¯‰æå››"å°æ˜åœ¨å­¦Python"

4. **è®°å¿†å¯è§†åŒ–**
   - åœ¨UIä¸­æ˜¾ç¤ºNPC"è®°å¾—"çš„å…³é”®äº‹ä»¶
   - è®©ç©å®¶äº†è§£NPCå¯¹è‡ªå·±çš„å°è±¡

5. **æ—¶é—´è¡°å‡**
   - è¶Šä¹…çš„è®°å¿†è¶Šæ¨¡ç³Š
   - æ¨¡æ‹Ÿäººç±»è®°å¿†çš„"é—å¿˜æ›²çº¿"

---

## ğŸ“ ç»ƒä¹ ä»»åŠ¡

### åŸºç¡€ä»»åŠ¡

- [ ] ä¸NPCå¯¹è¯ï¼Œä»‹ç»è‡ªå·±çš„åå­—å’Œå…´è¶£
- [ ] 5åˆ†é’Ÿåï¼Œé—®NPC"ä½ è¿˜è®°å¾—æˆ‘çš„åå­—å—ï¼Ÿ"
- [ ] è§‚å¯ŸNPCæ˜¯å¦èƒ½å›å¿†èµ·ä¹‹å‰çš„å¯¹è¯

### è¿›é˜¶ä»»åŠ¡

- [ ] ä¸NPCè¿›è¡Œæ·±åº¦å¯¹è¯ï¼ˆ5è½®ä»¥ä¸Šï¼‰
- [ ] ç¬¬äºŒå¤©é‡æ–°è¿›å…¥æ¸¸æˆï¼Œæµ‹è¯•é•¿æœŸè®°å¿†
- [ ] æŸ¥çœ‹ `backend/memory_data/` ç›®å½•ä¸‹çš„è®°å¿†æ–‡ä»¶
- [ ] é˜…è¯» HelloAgents çš„ MemoryManager æºç 

### æŒ‘æˆ˜ä»»åŠ¡

- [ ] ä¿®æ”¹ `working_memory_capacity`ï¼Œæµ‹è¯•ä¸åŒå®¹é‡çš„æ•ˆæœ
- [ ] è°ƒæ•´ `forgetting_threshold`ï¼Œè§‚å¯Ÿé—å¿˜æœºåˆ¶
- [ ] å®ç°è®°å¿†å¯¼å‡ºåŠŸèƒ½ï¼ˆå¯¼å‡ºNPCçš„æ‰€æœ‰è®°å¿†ï¼‰
- [ ] è®¾è®¡ä¸€ä¸ª"è®°å¿†ç›¸å†Œ"UIï¼Œå±•ç¤ºé‡è¦å¯¹è¯

---

## ğŸ“Š è®°å¿†ç³»ç»Ÿ vs ä¼ ç»ŸèŠå¤©

### ä¼ ç»ŸèŠå¤©æœºå™¨äºº

```
ğŸ‘¤ "ä½ å¥½ï¼Œæˆ‘å«å°æ˜"
ğŸ¤– "ä½ å¥½ï¼"

ï¼ˆ5åˆ†é’Ÿåï¼‰
ğŸ‘¤ "æˆ‘æ˜¯è°ï¼Ÿ"
ğŸ¤– "æˆ‘ä¸çŸ¥é“ä½ æ˜¯è°" âŒ
```

### èµ›åšå°é•‡ï¼ˆæœ‰è®°å¿†ï¼‰

```
ğŸ‘¤ "ä½ å¥½ï¼Œæˆ‘å«å°æ˜"
ğŸ¤– "ä½ å¥½å°æ˜ï¼"
ğŸ’¾ [ä¿å­˜åˆ°å·¥ä½œè®°å¿†]

ï¼ˆ5åˆ†é’Ÿåï¼‰
ğŸ‘¤ "æˆ‘æ˜¯è°ï¼Ÿ"
ğŸ¤– "ä½ æ˜¯å°æ˜å•Šï¼" âœ…
ğŸ’¾ [ä»å·¥ä½œè®°å¿†ä¸­æ£€ç´¢]
```

---

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### å‘é‡æ£€ç´¢åŸç†

```python
# 1. å°†å¯¹è¯è½¬æ¢ä¸ºå‘é‡
player_message_vector = encode("ä½ å¥½ï¼Œæˆ‘å«å°æ˜")

# 2. è®¡ç®—ä¸å†å²è®°å¿†çš„ç›¸ä¼¼åº¦
for memory in all_memories:
    memory_vector = encode(memory.content)
    similarity = cosine_similarity(player_message_vector, memory_vector)

# 3. è¿”å›æœ€ç›¸ä¼¼çš„è®°å¿†
top_memories = sorted_by_similarity[:5]
```

### Tokenæ§åˆ¶ç­–ç•¥

```python
# æ§åˆ¶è®°å¿†ä¸è¶…è¿‡tokené™åˆ¶
working_memory_tokens = 2000

# å¦‚æœè¶…è¿‡é™åˆ¶ï¼Œè‡ªåŠ¨æˆªæ–­æˆ–æ€»ç»“
if current_tokens > working_memory_tokens:
    # æ–¹æ¡ˆ1: åˆ é™¤æœ€æ—§çš„è®°å¿†
    remove_oldest_memory()
    
    # æ–¹æ¡ˆ2: ç”¨LLMæ€»ç»“è®°å¿†
    summarized = llm.summarize(old_memories)
    replace_with_summary(summarized)
```

---

**åˆ›å»ºæ—¶é—´**: 2025-12-28  
**çŠ¶æ€**: ğŸ“š å­¦ä¹ ä¸­  
**ä¸‹ä¸€æ­¥**: è§‚å¯Ÿåç«¯æ—¥å¿—å’ŒAPIæ–‡æ¡£
