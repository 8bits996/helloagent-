# DeepResearch 服务启动指南

**更新时间**: 2025-12-27  
**状态**: ✅ 问题已解决，服务正常运行

---

## 🎯 快速启动

### 方法1：使用Python启动脚本（推荐）

**后端启动**:
```powershell
cd C:\Users\frankechen\CFP-Study\Task06\official-code\code\chapter14\helloagents-deepresearch\backend
python start_with_tavily.py
```

**前端启动**（新开一个PowerShell窗口）:
```powershell
cd C:\Users\frankechen\CFP-Study\Task06\official-code\code\chapter14\helloagents-deepresearch\frontend
npm run dev
```

**访问地址**:
- 前端: http://localhost:5174
- 后端: http://localhost:8000

---

## ⚠️ 重要提示

### 为什么不能直接启动 main.py？

如果直接运行 `python src\main.py`，会出现 `⚠️ TAVILY_API_KEY 未设置` 的警告，导致搜索功能无法正常工作。

**原因**: `hello_agents` 包在初始化时会检查系统环境变量，而此时项目的 `.env` 文件还没有被加载。

**解决方案**: 使用 `start_with_tavily.py` 脚本，它会在启动 Python 进程前设置环境变量。

---

## ✅ 验证服务状态

### 检查后端是否正常

运行测试脚本：
```powershell
cd C:\Users\frankechen\CFP-Study\Task06\official-code\code\chapter14\helloagents-deepresearch\backend
python test_stream.py
```

**预期输出**:
- ✅ Tavily 搜索引擎已初始化
- ✅ 4个研究任务完成
- ✅ 生成详细报告
- ⏱️ 耗时约 1-2 分钟

### 检查前端连接

在浏览器中访问 http://localhost:5174，应该能看到 DeepResearch 界面。

---

## 🔧 配置说明

### API 密钥配置

**Tavily API（已配置，正常工作）**:
```
API Key: YOUR_TAVILY_API_KEY_HERE
免费额度: 1000次/月
状态: ✅ 正常工作
```

**SERPER API（不支持）**:
```
API Key: YOUR_SERPER_API_KEY_HERE
状态: ❌ 当前版本不支持
```

**Metaso API（不支持）**:
```
API Key: YOUR_METASO_API_KEY_HERE
状态: ❌ 当前版本不支持
```

### LLM 配置（硅基流动）

```env
LLM_PROVIDER=custom
LLM_MODEL_ID=Qwen/Qwen2.5-7B-Instruct
LLM_API_KEY=YOUR_LLM_API_KEY_HERE
LLM_BASE_URL=https://api.siliconflow.cn/v1
```

---

## 📁 关键文件说明

### 启动脚本
- **`backend/start_with_tavily.py`** - 后端启动脚本（带Tavily环境变量）
- **`frontend/启动前端.ps1`** - 前端启动脚本

### 测试脚本
- **`backend/test_stream.py`** - 流式API测试（推荐使用）
- **`backend/test_quick.py`** - 快速测试
- **`backend/test_research_simple.py`** - 基础研究测试

### 配置文件
- **`backend/.env`** - 环境变量配置
- **`backend/src/main.py`** - 后端入口文件

### 文档
- **`问题诊断-Tavily配置失败.md`** - 完整问题诊断报告
- **`所有搜索API配置汇总.md`** - API密钥记录
- **`第14章-深入学习总结.md`** - 代码学习总结
- **`第14章-实战测试总结.md`** - 测试结果总结

---

## 🐛 常见问题

### 问题1: "localhost 拒绝了我们的连接请求"

**原因**: 后端或前端服务已停止

**解决**:
1. 检查后端是否在运行（查看 PowerShell 窗口）
2. 如果停止，重新运行启动命令
3. 等待5-10秒让服务完全启动

### 问题2: 搜索失败或生成空报告

**原因**: Tavily API 密钥未正确设置

**验证**: 查看后端日志，应该看到：
```
✅ Tavily 搜索引擎已初始化
🔧 混合搜索模式已启用，可用后端: tavily
```

**解决**: 确保使用 `start_with_tavily.py` 启动后端，而不是直接运行 `main.py`

### 问题3: DuckDuckGo 搜索失败

**错误信息**: `RuntimeError: DuckDuckGo 搜索失败: No results found`

**原因**: DuckDuckGo 有限流机制

**解决**: 使用 Tavily API（已配置），不要使用 DuckDuckGo

---

## 📊 系统架构

```
┌─────────────────────────────────────────┐
│          浏览器 (localhost:5174)         │
│         Vue 3 + TypeScript 前端          │
└────────────────┬────────────────────────┘
                 │ HTTP/SSE
                 ▼
┌─────────────────────────────────────────┐
│       FastAPI 后端 (localhost:8000)      │
│                                          │
│  ┌──────────────────────────────────┐   │
│  │   DeepResearchAgent (agent.py)   │   │
│  │                                  │   │
│  │  ├─ PlanningService (planner.py)│   │
│  │  ├─ SearchService (search.py)   │   │
│  │  └─ SummarizationService        │   │
│  └──────────────────────────────────┘   │
└────────────┬────────────┬────────────────┘
             │            │
             ▼            ▼
    ┌────────────┐  ┌─────────────┐
    │   Tavily   │  │ 硅基流动 LLM │
    │ 搜索引擎    │  │ Qwen2.5-7B  │
    └────────────┘  └─────────────┘
```

---

## 🎓 学习资源

- **课程**: Hello Agents - Task06 (Chapter 14)
- **主题**: DeepResearch Agent - TODO驱动的深度研究范式
- **代码位置**: `CFP-Study/Task06/official-code/code/chapter14/helloagents-deepresearch/`

---

## 💡 提示

1. **保持窗口打开**: 后端和前端需要各自保持一个PowerShell窗口打开
2. **按Ctrl+C停止**: 在对应的PowerShell窗口按Ctrl+C可以停止服务
3. **查看日志**: 所有运行日志都会实时显示在启动的PowerShell窗口中
4. **端口占用**: 如果端口被占用，可以修改 `.env` 中的 `PORT` 配置

---

## ✨ 成功标志

**后端启动成功标志**:
```
✅ Tavily 搜索引擎已初始化
🔧 混合搜索模式已启用，可用后端: tavily
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

**前端启动成功标志**:
```
VITE v6.4.1  ready in 550 ms

➜  Local:   http://localhost:5174/
➜  Network: use --host to expose
```

**测试成功标志**:
```
✅ 研究完成！
⏱️  总耗时: 126.4秒
📈 总事件数: 4664
```

---

**祝您学习愉快！** 🚀
